# 深入浅出索引（下）

> 内容提要：覆盖索引 最左前缀原则 索引下推

## 覆盖索引

某次查询的值已经在搜索的某个索引树（k）上了，那么这个索引就叫做覆盖索引  
比如`select id from T where k = 1`,id为主键，k为索引， 
k索引树叶子节点存储的就是主键id，无须回表  

**联合索引的设置就是覆盖索引的一种体现**

## 最左前缀原则

对于字符串索引可以使用 like 'xx%'来进行查询  
对于联合索引(name,age) `最左前缀`可以是最左N个字段  

最左前缀原则下`联合索引`的设计原则：

* 若通过调整顺序可以**减少索引数量**，那么这个顺序就是联合索引的顺序;  
  对于联合索引(a,b)不需要单独建立a索引，对于(b,a)不需要单独建立b索引；  
 
* 如果查询条件里只有b那么需要单独建立b索引，那么**空间原则**，建立(name,age)和(age)的索引  
  显然比(age,name)和(name)的组合更节省空间
  
## 索引下推

mysql5.6及之后版本，在索引遍历过程中对索引中包含的字段优先判断，直接过滤掉  
不符合满足条件的记录，减少回表次数
<font color='red'>实际并没有做到</font>

## 问题：

  有一个表结构如下：
  
  ```sql
  CREATE TABLE 'geek'(
  `a` int(11) not null,
  `b` int(11) not null,
  `c` int(11) not null,
  `d` int(11) not null,
  primary key (`a`,`b`),
  key `c`(`c`),
  key `ca`(`c`,`a`),
  key `cb`(`c`,`b`)
  ) engine = InnoDB;
  ```
  
  业务里还有这样的语句：
  
  ```sql
  select * from geek where c = N order by a limit 1;
  select * from geek where c = N order by b limit 1;
  ```

  由于历史原因，这个表需要a、b联合主键  
  那么联合主键(a,b)加上索引c已经包含了abc三个字段了，为什么还需要创建ca、cb两个索引？  
  那么分析上面连个语句，说明`ca`、`cb`是必须的吗？
  
  分析：  
  主键(ab)相当于order by a,b 先按a排序再按b排序，c无序  
  ca先按c排序再a排序  
  cb先按c排序再按b排序  
  
  `select * from geek where c = N order by a limit 1; `的目标是按c排序再按a排序，
  结合(ab)和c就可以实现，因此不需要ca索引
   
   
   