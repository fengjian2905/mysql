# 事务到底是隔离的还是不隔离的？

## 神奇的查询结果

1. 数据准备
   
   ```sql
   CREATE TABLE `t` (
       `id` int(11) NOT NULL,
       `k` int(11) DEFAULT NULL,
       PRIMARY KEY (`id`)
   ) ENGINE=InnoDB;

   insert into t(id,k) values(1,1),(2,2);
   ```

2. 事务A
   
   ```sql
    start transaction with consistent snapshot;
   ```

3. 事务B
   
   ```sql
   start transaction with consistent snapshot;
   ```

4. 事务C
   
   ```sql
   update t set k=k+1 where id=1;
   ```

5. 事务B： 查询结果 **3**
   
   ```sql
   select k from t where id = 1;
   ```

6. 事务A：查询结果 **1**

    ```sql
    select k from t where id=1;
    commit;
    ```

7. 事务B
   
   ```sql
   commit;
   ```

**注意：** 
* begin/start transaction 命令并不是一个事务的起点，在执行它们之后的第一个操作InnoDB表的语句，事务才真正启动； 
* 用`start transaction with consistent snapshot`命令让事务立即启动；

