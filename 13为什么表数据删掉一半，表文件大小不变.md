# 为什么表数据删掉一半，表文件大小不变？

## 表数据存放位置

`innodb_file_per_table` on 存放在单独文件中，off 存在共享表空间

drop table 命令： 

1. 对于单独文件，系统会直接删除这个文件
2. 对于共享表空间，则不会回收空间

## delelte 删除行导致的数据页空洞

删除一条记录，会将这个记录标记为删除，位置可以复用，磁盘文件并不会缩小  
删除整个数据页，则这个数据页可以复用  

## 数据页复用 VS 记录复用

记录复用只限于符合条件的数据  

整个页则可以复用任何位置，如果相邻连个页的利用率都很小，
系统会合并数据到一个数据页上，另一个被标记为可复用    

## insert 插入数据导致的数据页空洞

数据随机插入则会造成数据页分裂


## 空洞解决

重建表可以去除空洞

`alter table A engine==InnoDB`  

MySQL 5.6引入了online DDL,否则重建表的过程中会丢失数据，新的更新和写入都会无法进行

另外重建表很消耗 IO 和 CPU资源的，线上要选择恰当的时间进行操作，推荐 gh-ost来操作  

## online vs inplace

online 一定是inplace

inplace 不一定是online


## alter table VS analyze table VS optimize table

alter table 重建表  

analyze table 重新统计表索引信息  

optimize table = alter table + analyze table